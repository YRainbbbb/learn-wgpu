<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Model Loading | Learn Wgpu</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.3.1">
    
    <meta property="og:site_name" content="Learn Wgpu"><meta property="og:title" content="Model Loading"><meta property="og:type" content="website"><meta property="og:url" content="/beginner/tutorial9-models/"><meta name="twitter:title" content="Model Loading"><meta name="twitter:url" content="/beginner/tutorial9-models/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:label1" content="Written by"><meta name="twitter:data2" content="Benjamin R Hansen"><meta name="twitter:creator" content="https://twitter.com/sotrh760">
    <link rel="preload" href="/learn-wgpu/assets/css/0.styles.f819bcb6.css" as="style"><link rel="preload" href="/learn-wgpu/assets/js/app.267ede68.js" as="script"><link rel="preload" href="/learn-wgpu/assets/js/2.03974512.js" as="script"><link rel="preload" href="/learn-wgpu/assets/js/17.2877df2c.js" as="script"><link rel="prefetch" href="/learn-wgpu/assets/js/10.9bccf631.js"><link rel="prefetch" href="/learn-wgpu/assets/js/11.6eae5361.js"><link rel="prefetch" href="/learn-wgpu/assets/js/12.002ebbd1.js"><link rel="prefetch" href="/learn-wgpu/assets/js/13.0153bb4e.js"><link rel="prefetch" href="/learn-wgpu/assets/js/14.550809ab.js"><link rel="prefetch" href="/learn-wgpu/assets/js/15.b7740a7b.js"><link rel="prefetch" href="/learn-wgpu/assets/js/16.e3daa239.js"><link rel="prefetch" href="/learn-wgpu/assets/js/18.9be5c9f7.js"><link rel="prefetch" href="/learn-wgpu/assets/js/19.ad230b0f.js"><link rel="prefetch" href="/learn-wgpu/assets/js/20.3e27e89c.js"><link rel="prefetch" href="/learn-wgpu/assets/js/3.43b8c3cf.js"><link rel="prefetch" href="/learn-wgpu/assets/js/4.19fc9e85.js"><link rel="prefetch" href="/learn-wgpu/assets/js/5.a6098f21.js"><link rel="prefetch" href="/learn-wgpu/assets/js/6.80e303e9.js"><link rel="prefetch" href="/learn-wgpu/assets/js/7.726f4d2f.js"><link rel="prefetch" href="/learn-wgpu/assets/js/8.71713c50.js"><link rel="prefetch" href="/learn-wgpu/assets/js/9.156ae6d8.js">
    <link rel="stylesheet" href="/learn-wgpu/assets/css/0.styles.f819bcb6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="inner"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learn-wgpu/" class="home-link router-link-active"><!----> <span class="site-name">Learn Wgpu</span></a> <div class="links"><!----> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header> <div class="sidebar-mask"></div> <div class="docs-layout"><aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/learn-wgpu/" class="sidebar-link">Introduction</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Beginner</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-wgpu/beginner/tutorial1-window/" class="sidebar-link">Dependencies and the window</a></li><li><a href="/learn-wgpu/beginner/tutorial2-swapchain/" class="sidebar-link">The Swapchain</a></li><li><a href="/learn-wgpu/beginner/tutorial3-pipeline/" class="sidebar-link">The Pipeline</a></li><li><a href="/learn-wgpu/beginner/tutorial4-buffer/" class="sidebar-link">Buffers and Indices</a></li><li><a href="/learn-wgpu/beginner/tutorial5-textures/" class="sidebar-link">Textures and bind groups</a></li><li><a href="/learn-wgpu/beginner/tutorial6-uniforms/" class="sidebar-link">Uniform buffers and a 3d camera</a></li><li><a href="/learn-wgpu/beginner/tutorial7-instancing/" class="sidebar-link">Instancing</a></li><li><a href="/learn-wgpu/beginner/tutorial8-depth/" class="sidebar-link">The Depth Buffer</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Intermediate</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-wgpu/intermediate/windowless/" class="sidebar-link">Wgpu without a window</a></li></ul></section></li><li><a href="/learn-wgpu/news/" class="sidebar-link">News</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="model-loading"><a href="#model-loading" class="header-anchor">#</a> Model Loading</h1> <p>Up to this point we've been creating our models manually. While this is an acceptable way to do this, but it's really slow if we want to include complex models with lots of polygons. Because of this, we're going modify our code to leverage the obj model format so that we can create a model in a software such as blender and display it in our code.</p> <p>Our <code>main.rs</code> file is getting pretty cluttered, let's create a <code>model.rs</code> file that we can put our model loading code into.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// model.rs</span>
<span class="token keyword">pub</span> <span class="token keyword">trait</span> Vertex <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> desc<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> wgpu<span class="token punctuation">::</span>VertexBufferDescriptor<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[repr(C)]</span>
<span class="token attribute attr-name">#[derive(Copy, Clone, Debug)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> ModelVertex <span class="token punctuation">{</span>
    position<span class="token punctuation">:</span> <span class="token punctuation">[</span>f32<span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    tex_coords<span class="token punctuation">:</span> <span class="token punctuation">[</span>f32<span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    normal<span class="token punctuation">:</span> <span class="token punctuation">[</span>f32<span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> Vertex <span class="token keyword">for</span> ModelVertex <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> desc<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> wgpu<span class="token punctuation">::</span>VertexBufferDescriptor<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">unimplemented!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You'll notice a couple of things here. In <code>main.rs</code> we had <code>Vertex</code> as a struct, here we're using a trait. We could have multiple vertex types (model, UI, instance data, etc.). Making <code>Vertex</code> a trait will allow us to abstract our the <code>VertexBufferDescriptor</code> creation code to make creating <code>RenderPipeline</code>s simpler.</p> <p>Another thing to mention is the <code>normal</code> field in <code>ModelVertex</code>. We won't use this until we talk about lighting, but will add it to the struct for now.</p> <p>Let's define our <code>VertexBufferDescriptor</code>.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">impl</span> Vertex <span class="token keyword">for</span> ModelVertex <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> desc<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> wgpu<span class="token punctuation">::</span>VertexBufferDescriptor<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">use</span> std<span class="token punctuation">::</span>mem<span class="token punctuation">;</span>
        wgpu<span class="token punctuation">::</span>VertexBufferDescriptor <span class="token punctuation">{</span>
            stride<span class="token punctuation">:</span> mem<span class="token punctuation">::</span>size_of<span class="token punctuation">::</span><span class="token operator">&lt;</span>ModelVertex<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> wgpu<span class="token punctuation">::</span>BufferAddress<span class="token punctuation">,</span>
            step_mode<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>InputStepMode<span class="token punctuation">::</span>Vertex<span class="token punctuation">,</span>
            attributes<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>
                wgpu<span class="token punctuation">::</span>VertexAttributeDescriptor <span class="token punctuation">{</span>
                    offset<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    shader_location<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    format<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>VertexFormat<span class="token punctuation">::</span>Float3<span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                wgpu<span class="token punctuation">::</span>VertexAttributeDescriptor <span class="token punctuation">{</span>
                    offset<span class="token punctuation">:</span> mem<span class="token punctuation">::</span>size_of<span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>f32<span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> wgpu<span class="token punctuation">::</span>BufferAddress<span class="token punctuation">,</span>
                    shader_location<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    format<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>VertexFormat<span class="token punctuation">::</span>Float2<span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                wgpu<span class="token punctuation">::</span>VertexAttributeDescriptor <span class="token punctuation">{</span>
                    offset<span class="token punctuation">:</span> mem<span class="token punctuation">::</span>size_of<span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>f32<span class="token punctuation">;</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> wgpu<span class="token punctuation">::</span>BufferAddress<span class="token punctuation">,</span>
                    shader_location<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                    format<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>VertexFormat<span class="token punctuation">::</span>Float3<span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This is basically the same as the original <code>VertexBufferDescriptor</code>, but we added a <code>VertexAttributeDescriptor</code> for the <code>normal</code>.</p> <p>With all that in place we need a model to render. If you have one already that's great, but I've supplied a <a href="https://github.com/sotrh/learn-wgpu/tree/master/code/beginner/tutorial9-model/src/res" target="_blank" rel="noopener noreferrer">zip file<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> with the model and all of it's textures. We're going to put this model in a new <code>res</code> folder.</p> <p>Speaking of textures, let's refactor our code to make use of a new <code>Texture</code> class. Doing this now will make loading our models much easier. Create a new file called <code>texture.rs</code>.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">use</span> std<span class="token punctuation">::</span>path<span class="token punctuation">::</span>Path<span class="token punctuation">;</span>
<span class="token keyword">use</span> image<span class="token punctuation">::</span>GenericImageView<span class="token punctuation">;</span>

<span class="token keyword">pub</span> <span class="token keyword">struct</span> Texture <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> texture<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>Texture<span class="token punctuation">,</span>
    <span class="token keyword">pub</span> view<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>TextureView<span class="token punctuation">,</span>
    <span class="token keyword">pub</span> sampler<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>Sampler<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> Texture <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> load<span class="token operator">&lt;</span>P<span class="token punctuation">:</span> AsRef<span class="token operator">&lt;</span>Path<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>device<span class="token punctuation">:</span> <span class="token operator">&amp;</span>wgpu<span class="token punctuation">::</span>Device<span class="token punctuation">,</span> path<span class="token punctuation">:</span> P<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> Result<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">Self</span><span class="token punctuation">,</span> wgpu<span class="token punctuation">::</span>CommandBuffer<span class="token punctuation">)</span><span class="token punctuation">,</span> failure<span class="token punctuation">::</span>Error<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> img <span class="token operator">=</span> image<span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
        <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">from_image</span><span class="token punctuation">(</span>device<span class="token punctuation">,</span> <span class="token operator">&amp;</span>img<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">from_bytes</span><span class="token punctuation">(</span>device<span class="token punctuation">:</span> <span class="token operator">&amp;</span>wgpu<span class="token punctuation">::</span>Device<span class="token punctuation">,</span> bytes<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>u8<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> Result<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">Self</span><span class="token punctuation">,</span> wgpu<span class="token punctuation">::</span>CommandBuffer<span class="token punctuation">)</span><span class="token punctuation">,</span> failure<span class="token punctuation">::</span>Error<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> img <span class="token operator">=</span> image<span class="token punctuation">::</span><span class="token function">load_from_memory</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
        <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">from_image</span><span class="token punctuation">(</span>device<span class="token punctuation">,</span> <span class="token operator">&amp;</span>img<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">from_image</span><span class="token punctuation">(</span>device<span class="token punctuation">:</span> <span class="token operator">&amp;</span>wgpu<span class="token punctuation">::</span>Device<span class="token punctuation">,</span> img<span class="token punctuation">:</span> <span class="token operator">&amp;</span>image<span class="token punctuation">::</span>DynamicImage<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> Result<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">Self</span><span class="token punctuation">,</span> wgpu<span class="token punctuation">::</span>CommandBuffer<span class="token punctuation">)</span><span class="token punctuation">,</span> failure<span class="token punctuation">::</span>Error<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">unimplemented!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>load</code> and <code>from_bytes</code> methods simply prepare a <code>image::DynamicImage</code> to pass to <code>from_image</code>. Let's pull over a modified version of our texture creation code into <code>from_image</code>.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">from_image</span><span class="token punctuation">(</span>device<span class="token punctuation">:</span> <span class="token operator">&amp;</span>wgpu<span class="token punctuation">::</span>Device<span class="token punctuation">,</span> img<span class="token punctuation">:</span> <span class="token operator">&amp;</span>image<span class="token punctuation">::</span>DynamicImage<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> Result<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">Self</span><span class="token punctuation">,</span> wgpu<span class="token punctuation">::</span>CommandBuffer<span class="token punctuation">)</span><span class="token punctuation">,</span> failure<span class="token punctuation">::</span>Error<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> rgba <span class="token operator">=</span> img<span class="token punctuation">.</span><span class="token function">as_rgba8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> dimensions <span class="token operator">=</span> img<span class="token punctuation">.</span><span class="token function">dimensions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> size <span class="token operator">=</span> wgpu<span class="token punctuation">::</span>Extent3d <span class="token punctuation">{</span>
        width<span class="token punctuation">:</span> dimensions<span class="token number">.0</span><span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> dimensions<span class="token number">.1</span><span class="token punctuation">,</span>
        depth<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> texture <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_texture</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>wgpu<span class="token punctuation">::</span>TextureDescriptor <span class="token punctuation">{</span>
        size<span class="token punctuation">,</span>
        array_layer_count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        mip_level_count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        sample_count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        dimension<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>TextureDimension<span class="token punctuation">::</span>D2<span class="token punctuation">,</span>
        format<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>TextureFormat<span class="token punctuation">::</span>Rgba8UnormSrgb<span class="token punctuation">,</span>
        usage<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>TextureUsage<span class="token punctuation">::</span>SAMPLED <span class="token operator">|</span> wgpu<span class="token punctuation">::</span>TextureUsage<span class="token punctuation">::</span>COPY_DST<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> buffer <span class="token operator">=</span> device
        <span class="token punctuation">.</span><span class="token function">create_buffer_mapped</span><span class="token punctuation">(</span>rgba<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> wgpu<span class="token punctuation">::</span>BufferUsage<span class="token punctuation">::</span>COPY_SRC<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">fill_from_slice</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rgba<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> <span class="token keyword">mut</span> encoder <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_command_encoder</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Default<span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    encoder<span class="token punctuation">.</span><span class="token function">copy_buffer_to_texture</span><span class="token punctuation">(</span>
        wgpu<span class="token punctuation">::</span>BufferCopyView <span class="token punctuation">{</span>
            buffer<span class="token punctuation">:</span> <span class="token operator">&amp;</span>buffer<span class="token punctuation">,</span>
            offset<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            row_pitch<span class="token punctuation">:</span> <span class="token number">4</span> <span class="token operator">*</span> dimensions<span class="token number">.0</span><span class="token punctuation">,</span>
            image_height<span class="token punctuation">:</span> dimensions<span class="token number">.1</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        wgpu<span class="token punctuation">::</span>TextureCopyView <span class="token punctuation">{</span>
            texture<span class="token punctuation">:</span> <span class="token operator">&amp;</span>texture<span class="token punctuation">,</span>
            mip_level<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            array_layer<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            origin<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>Origin3d<span class="token punctuation">::</span>ZERO<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        size<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> cmd_buffer <span class="token operator">=</span> encoder<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> view <span class="token operator">=</span> texture<span class="token punctuation">.</span><span class="token function">create_default_view</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> sampler <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_sampler</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>wgpu<span class="token punctuation">::</span>SamplerDescriptor <span class="token punctuation">{</span>
        address_mode_u<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>AddressMode<span class="token punctuation">::</span>ClampToEdge<span class="token punctuation">,</span>
        address_mode_v<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>AddressMode<span class="token punctuation">::</span>ClampToEdge<span class="token punctuation">,</span>
        address_mode_w<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>AddressMode<span class="token punctuation">::</span>ClampToEdge<span class="token punctuation">,</span>
        mag_filter<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>FilterMode<span class="token punctuation">::</span>Linear<span class="token punctuation">,</span>
        min_filter<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>FilterMode<span class="token punctuation">::</span>Nearest<span class="token punctuation">,</span>
        mipmap_filter<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>FilterMode<span class="token punctuation">::</span>Nearest<span class="token punctuation">,</span>
        lod_min_clamp<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">100.0</span><span class="token punctuation">,</span>
        lod_max_clamp<span class="token punctuation">:</span> <span class="token number">100.0</span><span class="token punctuation">,</span>
        compare_function<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>CompareFunction<span class="token punctuation">::</span>Always<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">Self</span> <span class="token punctuation">{</span> texture<span class="token punctuation">,</span> view<span class="token punctuation">,</span> sampler <span class="token punctuation">}</span><span class="token punctuation">,</span> cmd_buffer<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You may have noticed two things.</p> <ol><li>We're not creating a <code>BindGroup</code> for <code>Texture</code>. I've decided to store the <code>BindGroup</code> separate from the texture, so that the <code>Texture</code> doesn't need to know about how the <code>BindGroup</code> should be layed out.</li> <li>We're returning a <code>CommandBuffer</code> with our <code>Texture</code>. This is very common practice as the <code>queue</code> can process multiple command buffers at once. This also prevents us from needing to pass in the <code>queue</code> as a mutable reference.</li></ol> <p>The changes to <code>main.rs</code> are fairly simple.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">mod</span> texture<span class="token punctuation">;</span>

<span class="token keyword">struct</span> State <span class="token punctuation">{</span>
    diffuse_texture<span class="token punctuation">:</span> texture<span class="token punctuation">::</span>Texture<span class="token punctuation">,</span>
    diffuse_bind_group<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>BindGroup<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div></div><div class="global-ui"><!----></div></div>
    <script src="/learn-wgpu/assets/js/app.267ede68.js" defer></script><script src="/learn-wgpu/assets/js/2.03974512.js" defer></script><script src="/learn-wgpu/assets/js/17.2877df2c.js" defer></script>
  </body>
</html>
